<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>AQI on Wang's Blog</title><link>https://wastu01.github.io/tags/aqi/</link><description>Recent content in AQI on Wang's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><copyright>版權 Wang</copyright><lastBuildDate>Tue, 03 Oct 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://wastu01.github.io/tags/aqi/index.xml" rel="self" type="application/rss+xml"/><item><title>Python-爬取空氣品質-PM2.5-AQI</title><link>https://wastu01.github.io/article/python-pm25-aqi-opendata/</link><pubDate>Tue, 03 Oct 2023 00:00:00 +0000</pubDate><guid>https://wastu01.github.io/article/python-pm25-aqi-opendata/</guid><description>&lt;img src="https://wastu01.github.io/article/python-pm25-aqi-opendata/Air-Quality-Index-Data-Set-Introduction.png" alt="Featured image of post Python-爬取空氣品質-PM2.5-AQI" />&lt;p>&lt;kbd>Python&lt;/kbd> + &lt;kbd>PM25&lt;/kbd> + &lt;kbd>AQI&lt;/kbd>&lt;/p>
&lt;p>此篇是透過 Python 爬取 &lt;a class="link" href="https://airtw.moenv.gov.tw/cht/Information/Standard/AirQualityIndicator.aspx" target="_blank" rel="noopener"
>AQI&lt;/a> 空氣品質指標的資料，再篩選出我們熟悉的細懸浮微粒 PM2.5數據儲存成檔案。&lt;/p>
&lt;p>2024 可斟酌搭配 ChatGPT/ClaudeAI 提問如何用 python 爬取 pm2.5，(或是使用 AutoGPT 設定明確目標執行爬蟲)，剩下來的時間了解資料結構該如何轉換，思考如何應用在日常生活中，例如用折線圖呈現產出一天內空氣品質變化，結合 &lt;a class="link" href="https://ifttt.com" target="_blank" rel="noopener"
>IFTTT&lt;/a> 超過多少會提醒用戶之類的，並將資料搜集彙整顯示趨勢圖，以供後續研究。&lt;/p>
&lt;p>2023-0826 更新：因工作緣故收到國家科學及技術委員會來函,配合本署組改為環境部，本署環境資料關放平臺、環境資源資料交換平臺及環境資源資料交換重構平臺自112年8月22日起變更網址及應用程式介面( Application ProgrammingInterface, API)，各平臺API維持新、舊API URL平行服務三個月，請於112年11月22日期限前內完成 API URL 更新。&lt;/p>
&lt;hr>
&lt;p>課堂作業：透過 Pythob 爬取空氣品質 PM2.5 數據，練習如何抓取政府資料開放平台公開資料，解析 &lt;code>JSON&lt;/code> 檔案並做檔案處理。&lt;/p>
&lt;h2 id="資料型態">資料型態
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>我們資料取得的是 &lt;code>JSON&lt;/code> 格式&lt;/p>
&lt;/li>
&lt;li>
&lt;p>requests 獲取資料後將 Json 解析成字典 Dictionary&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>檢視 Json 的擴充工具 (chrome)： &lt;a class="link" href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc" target="_blank" rel="noopener"
>https://chrome.google.com/webstore/detail/jsonview/&lt;/a>&lt;/p>
&lt;p>常見的資料格式 : JSON、CSV、XML&lt;/p>
&lt;p>可參考此篇說明：&lt;a class="link" href="https://tw.alphacamp.co/blog/api-introduction-understand-web-api-http-json" target="_blank" rel="noopener"
>認識 Web API、HTTP 和 JSON 資料交換格式&lt;/a>&lt;/p>
&lt;h2 id="資訊擷取來源">資訊擷取來源
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://data.gov.tw" target="_blank" rel="noopener"
>https://data.gov.tw/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://static.coderbridge.com/img/mrwang01/7f812f1495c2457dab774d63ba22ed78.png"
loading="lazy"
>&lt;/p>
&lt;p>後來發現有更好用 最新試行版(已正式上架)的&lt;/p>
&lt;p>&lt;a class="link" href="https://data.moenv.gov.tw/" target="_blank" rel="noopener"
>環保署環境資料開放平台開放資料 API&lt;/a>&lt;/p>
&lt;p>註冊 API Key 後可以篩選更多參數來撈資料&lt;/p>
&lt;p>要解析的 json 網址：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://data.gov.tw/dataset/40448" target="_blank" rel="noopener"
>每小時提供各測站之空氣品質指標（AQI）&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://data.epa.gov.tw/api/v1/aqx_p_432?offset=0&amp;amp;limit=80&amp;amp;api_key=https://youtu.be/dQw4w9WgXcQ" target="_blank" rel="noopener"
>非公開 API 點擊無效&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>資料集名稱先記好比較快找到&lt;/p>
&lt;p>&lt;img src="https://data.moenv.gov.tw/_nuxt/img/access_data_img_zh_02.90b96df.png"
loading="lazy"
>&lt;/p>
&lt;p>註冊 API 使用說明：
&lt;a class="link" href="https://data.moenv.gov.tw/paradigm" target="_blank" rel="noopener"
>https://data.moenv.gov.tw/paradigm&lt;/a>&lt;/p>
&lt;p>該單位也提供了手冊講解如何使用參數，Python 程式範例可供參考( api 網址記得更換到最新版本)&lt;/p>
&lt;h2 id="篩選資料">篩選資料
&lt;/h2>&lt;p>整個流程：request &amp;raquo;&amp;gt; json &amp;raquo;&amp;gt; dict &amp;raquo;&amp;gt; list &amp;raquo;&amp;gt; dict &amp;raquo; key get value&lt;/p>
&lt;p>request 獲得資料，用 json() 方法，將資料轉成字典，Python 可以操作的資料型態。&lt;/p>
&lt;p>我們要撈出的資料是 :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;record&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[{&lt;/span>&lt;span class="s2">&amp;#34;sitename&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;各縣市&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;pm2.5&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">其他數據&lt;/span>&lt;span class="p">},{&lt;/span>&lt;span class="n">同樣格式&lt;/span>&lt;span class="p">}]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>aqi&lt;/code> (value) 最外層是 &lt;code>list&lt;/code> 資料型態，再從裡面的 &lt;code>dict&lt;/code> 透過 &lt;code>key&lt;/code> (sitename,pm2.5) 取 &lt;code>value&lt;/code> (各縣市,10)。這也代表 list 裡面只要是物件都可以放入。&lt;/p>
&lt;p>讀取資料的實作過程可以搭配&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">dir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requests&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>會更容易了解有什麼方法可以用，資料型態是什麼&lt;/p>
&lt;h2 id="實作過程">實作過程
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aqi_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;https://data.epa.gov.tw/api/v1/aqx_p_432?offset=0&amp;amp;limit=80&amp;amp;api_key=自行註冊&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 環保署環境資料開放平臺 試行版 https://data.epa.gov.tw/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># API 金鑰免費申請 ～&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">requests&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aqi_url&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aqi&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">json&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="s1">&amp;#39;records&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">status_code&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### 200  正常回傳&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### 404 回傳錯誤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aqi&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://static.coderbridge.com/img/mrwang01/8f8cccef2a934901ac68b62e16c60b7a.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="資料輸出">資料輸出
&lt;/h2>&lt;p>&lt;img src="https://static.coderbridge.com/img/mrwang01/92475ef8e70f465492ae72420bb458e5.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="檔案處理">檔案處理
&lt;/h2>&lt;p>“r” 唯讀模式&lt;/p>
&lt;p>“w” 寫入模式（覆寫）&lt;/p>
&lt;p>“a” 寫入模式（續寫）&lt;/p>
&lt;p>&lt;code>with open(&amp;quot;data_pm25.txt&amp;quot;, &amp;quot;w&amp;quot;, encoding=&amp;quot;utf-8&amp;quot;) as file:&lt;/code>&lt;/p>
&lt;p>再用 for 把資料寫入 file 當中&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">f&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;file.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;w&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;file-write&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>檔案讀寫的部分，rwa&amp;quot;+&amp;quot; 模式
可以都試試看，小心檔案被覆蓋
w+ 先讀再寫會：？
a+ 先寫再讀會：？&lt;/p>
&lt;h2 id="參考資料">參考資料
&lt;/h2>&lt;p>&lt;a class="link" href="https://medium.com/datainpoint/python-essentials/home" target="_blank" rel="noopener"
>輕鬆學習 Python | 資料分析&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://medium.com/datainpoint/python-essentials-requesting-web-api-edd417a57ba5" target="_blank" rel="noopener"
>輕鬆學習 Python：透過 API 擷取網站資料&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://medium.com/ccclub/ccclub-python-for-beginners-tutorial-bf0648108581" target="_blank" rel="noopener"
>Python 初學第十二講—檔案處理&lt;/a>&lt;/p>
&lt;p>補充：ChatGPT 指令大全
&lt;a class="link" href="https://www.explainthis.io/zh-hant/chatgpt" target="_blank" rel="noopener"
>https://www.explainthis.io/zh-hant/chatgpt&lt;/a>&lt;/p>
&lt;p>本篇文章自 &lt;a class="link" href="https://index.coderbridge.io" target="_blank" rel="noopener"
>index.coderbridge&lt;/a> 平台移轉此處&lt;/p>
&lt;p>並重新將資料型態的部分重新說明。&lt;/p></description></item></channel></rss>